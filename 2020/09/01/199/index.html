<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.2">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.2" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.2">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Build a Modern Computer from First Principles: Nand to Tetris Part I (project-centered course)$~~~~$接触到这门课程是在知乎上有人强烈推荐的，感觉这种靠谱的课程特别是有意义。网上搜了下背景资料，似乎这门课程是给哈佛大学的本科生开的课程，我是在工作之余陆陆续续的将这门课程的上半部分学完了，每周差不多要花">
<meta name="keywords" content="coursera">
<meta property="og:type" content="article">
<meta property="og:title" content="【Coursera】 Build a Modern Computer From First Principles:Nand to Tetris Part I">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;09&#x2F;01&#x2F;199&#x2F;index.html">
<meta property="og:site_name" content="blow in the wind">
<meta property="og:description" content="Build a Modern Computer from First Principles: Nand to Tetris Part I (project-centered course)$~~~~$接触到这门课程是在知乎上有人强烈推荐的，感觉这种靠谱的课程特别是有意义。网上搜了下背景资料，似乎这门课程是给哈佛大学的本科生开的课程，我是在工作之余陆陆续续的将这门课程的上半部分学完了，每周差不多要花">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;CYjRFA7yud2zpc3.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;EUjtDbwKPM6BcOy.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;mrEAYdo6Z7qsxcF.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;PnVvFBZbwH41Eys.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;IvqXaKgQh3OFnZk.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;4jIJB1KmXtFs293.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;7vCXQfioMIUTa5R.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;57F2CdWSs8teQxl.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;QkbmiatBnFzNIYV.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;sTAGiozmSlw8Ykv.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;6hswpjAoX8TQEqr.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;lfxhSpP3nIM7z8o.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;xuN9dYi7sKLPBnH.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;nhXMcdkV9eS4W2B.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;QkbmiatBnFzNIYV.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;fFDZK8HrBYs9uhQ.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;HRDN1X2iuO6BWlr.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;ZNPM2d9aIQYODCl.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;2zXTNlhvWBJEytj.png">
<meta property="og:updated_time" content="2020-09-11T05:21:54.621Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;09&#x2F;11&#x2F;CYjRFA7yud2zpc3.png">

<link rel="canonical" href="http://yoursite.com/2020/09/01/199/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>【Coursera】 Build a Modern Computer From First Principles:Nand to Tetris Part I | blow in the wind</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="blow in the wind" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">blow in the wind</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">no one will be your god, your god is just yourself!</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/mike-box" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/01/199/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pic.jpg">
      <meta itemprop="name" content="Mike meng">
      <meta itemprop="description" content="a clever man and a foolish man!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blow in the wind">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【Coursera】 Build a Modern Computer From First Principles:Nand to Tetris Part I
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-01 16:13:44" itemprop="dateCreated datePublished" datetime="2020-09-01T16:13:44+08:00">2020-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-11 13:21:54" itemprop="dateModified" datetime="2020-09-11T13:21:54+08:00">2020-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%85%AC%E5%BC%80%E8%AF%BE/" itemprop="url" rel="index">
                    <span itemprop="name">公开课</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/09/01/199/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/09/01/199/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Build-a-Modern-Computer-from-First-Principles-Nand-to-Tetris-Part-I-project-centered-course"><a href="#Build-a-Modern-Computer-from-First-Principles-Nand-to-Tetris-Part-I-project-centered-course" class="headerlink" title="Build a Modern Computer from First Principles: Nand to Tetris Part I (project-centered course)"></a>Build a Modern Computer from First Principles: Nand to Tetris Part I (project-centered course)</h1><p>$~~~~$接触到这门课程是在知乎上有人强烈推荐的，感觉这种靠谱的课程特别是有意义。网上搜了下背景资料，似乎这门课程是给哈佛大学的本科生开的课程，我是在工作之余陆陆续续的将这门课程的上半部分学完了，每周差不多要花上至少三个小时，后面的project还是非常有意思的。这门课程上半部分主要是讲如何从最基本的与非门搭建成一个完成的计算机，下半部分主要是讲在自己搭建的计算机上如何实现虚拟机、高级语言编译器、操作系统等等相关的课程。总的来说课程还是非常有意思的，特别适合稍微有计算机基础的人士来学这门课程，这门课程的前置课程是哈佛大学的<code>cs101</code>计算机基础课程。在学习的过程中确实有几个<code>project</code>还是需要费点时间和精力来理解该课程。我觉得最爽的是课程的<code>project</code>，含金量非常高了，主要是有兴趣，各种<code>project</code>的难度适中，并且非常有意思。</p><a id="more"></a>
<ul>
<li><p>开发这门课程的作者为<code>Shimon Schocken</code>,作者为上个世纪毕业于<code>mit</code>高材生，目前在以色列的耶路撒冷大学任教，同时作者也是一个非常出色的教育家，在<code>youtube</code>上可以看到作者的演讲：(<a href="https://www.youtube.com/watch?v=iE7YRHxwoDs)，非常适合非专业人士业余学习计算系统。" target="_blank" rel="noopener">https://www.youtube.com/watch?v=iE7YRHxwoDs)，非常适合非专业人士业余学习计算系统。</a></p>
</li>
<li><p>通过该课程可以让人快速的接触到计算机系统的从底层到上层的全貌。虽然不如计算专业的学生对计算机系统的每个部分都学习那么深，但是确实是一门能够让人快速入门且有意思的课程，作者从最基础上的与非门讲起，然后逐步深入到<code>mux</code>与<code>demux</code>,然后到最基本的加法器，累加器，逻辑运算器<code>ALU</code>,接着深入到逻辑存储器、寄存器,再到自建的<code>hack</code>汇编语言，最后到包括最基本的<code>CPU</code>,<code>memory</code>,<code>rom</code>的最小计算机系统的搭建，最后一章的内容为搭建一个基本的<code>hack</code>汇编程序的解释器，将<code>hack</code>汇编代码直接翻译成<code>hack</code>的机器码，比较简单。课程的基本路线如下：</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/CYjRFA7yud2zpc3.png" alt="1"><br>上半部分课程主要讲了<code>hardware</code>平台，下班部分正在学习主要是<code>software</code>部分。都比较有意思，强烈推荐对技术感兴趣的同学学习这个课程。</p>
<ul>
<li>虽然本课程作为基础课程，基本上大部分内容在计算机专业本科的课程计算机组成原理中都学习过，不是特别难。但是本科的课程中，有许多许多的知识点并没有讲清楚，特别是本科课程中基本上只讲理论，并没有将理论联系实际，设计这么具体的计算机系统，十几年前学的计算机组成原理感觉越来越落后时代。但是基本概念还在心中，至少对计算机底层的逻辑架构有了初步的认识，对于最新的技术，其实很快就能捡起来。该课程的<code>project</code>代码全部靠自己业余时间完成，全部通过给出的测试脚本，还是满满的成就感。YouTube有个非常有名的<code>up</code>主<code>Ben Eate</code>，他的课程为自制<code>8</code>位计算机，里面有全部的原理，部分器件的原理可以参考他的<code>YouTube</code>频道，还是非常有意思,f非常不错的学习资料。(<a href="https://www.youtube.com/c/BenEater/" target="_blank" rel="noopener">https://www.youtube.com/c/BenEater/</a>)</li>
</ul>
<p>分别分章节来介绍每个章节，所有<code>project</code>的代码全部上传放在<code>github</code>上。<br><a href="https://github.com/mike-box/coursera/tree/master/Build%20a%20computer/nand2tetris/nand2tetris/projects" target="_blank" rel="noopener">课程代码</a></p>
<h2 id="week1-Boolean-Logic"><a href="#week1-Boolean-Logic" class="headerlink" title="week1 Boolean Logic"></a>week1 Boolean Logic</h2><p>$\qquad$第一章主要介绍了最基本的二进制的概念，基本的逻辑布尔代数的运算，并通过<code>HDL</code>语言由最基本的与非门组成各种各样的器件，当然最复杂的可能是<code>dmux</code>和<code>mux</code>电路，这两个基本电路用到的逻辑门器件较多，因为其中都存在各种布尔代数换算，通过公式换算即可。当然最基本的译码器与编码器是组成原理中的基本电路，非常简单。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 8-way demultiplexor:</span></span><br><span class="line"><span class="comment"> * &#123;a, b, c, d, e, f, g, h&#125; = &#123;in, 0, 0, 0, 0, 0, 0, 0&#125; if sel == 000</span></span><br><span class="line"><span class="comment"> *                            &#123;0, in, 0, 0, 0, 0, 0, 0&#125; if sel == 001</span></span><br><span class="line"><span class="comment"> *                            etc.</span></span><br><span class="line"><span class="comment"> *                            &#123;0, 0, 0, 0, 0, 0, 0, in&#125; if sel == 111</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// This file is part of www.nand2tetris.org</span></span><br><span class="line"><span class="comment">// and the book "The Elements of Computing Systems"</span></span><br><span class="line"><span class="comment">// by Nisan and Schocken, MIT Press.</span></span><br><span class="line"><span class="comment">// File name: projects/01/DMux4Way.hdl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4-way demultiplexor:</span></span><br><span class="line"><span class="comment"> * &#123;a, b, c, d&#125; = &#123;in, 0, 0, 0&#125; if sel == 00</span></span><br><span class="line"><span class="comment"> *                &#123;0, in, 0, 0&#125; if sel == 01</span></span><br><span class="line"><span class="comment"> *                &#123;0, 0, in, 0&#125; if sel == 10</span></span><br><span class="line"><span class="comment"> *                &#123;0, 0, 0, in&#125; if sel == 11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CHIP DMux &#123;</span><br><span class="line">    IN in, sel;</span><br><span class="line">    OUT a, b;</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    Not (in = sel, out = notsel);</span><br><span class="line">    And (a = in, b = notsel, out = a);</span><br><span class="line">    And (a = in, b = sel, out = b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CHIP DMux4Way &#123;</span><br><span class="line">    IN in, sel[<span class="number">2</span>];</span><br><span class="line">    OUT a, b, c, d;</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">//using Dmux</span></span><br><span class="line">    DMux (in = in, sel = sel[<span class="number">1</span>], a = selab, b = selcd);</span><br><span class="line">    DMux (in = selab, sel = sel[<span class="number">0</span>], a = a, b = b);</span><br><span class="line">    DMux (in = selcd, sel = sel[<span class="number">0</span>], a = c, b = d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CHIP DMux8Way &#123;</span><br><span class="line">    IN in, sel[<span class="number">3</span>];</span><br><span class="line">    OUT a, b, c, d, e, f, g, h;</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">//DMux 8 way using three DMux</span></span><br><span class="line">    DMux (in = in, sel = sel[<span class="number">2</span>], a = selabcd, b = selefgh);</span><br><span class="line">    DMux4Way(in = selabcd, sel = sel[<span class="number">0.</span><span class="number">.1</span>], a = a, b = b, c = c, d = d);</span><br><span class="line">    DMux4Way(in = selefgh, sel = sel[<span class="number">0.</span><span class="number">.1</span>], a = e, b = f, c = g, d = h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="week2-Boolean-Arithmetic"><a href="#week2-Boolean-Arithmetic" class="headerlink" title="week2 Boolean Arithmetic"></a>week2 Boolean Arithmetic</h2><p>本课程适合有计算机基础的人士，进度非常快，基本上第二章开始就进入基本的加法器、乘法器、累加器的设计，实际还是挺复杂的，需要一定的逻辑电路基础。</p>
<ul>
<li><code>16</code>位加法器的实现,具体实现的时候分为两种办法，一种是直接用16个全加器进行串联起来，另一种就是利用公式推导快速加法器。虽然利用全加器串联起来很简单，需要用的门电路也很少，但是在实际工程中肯定是时延非常大。用快速的加法器虽然可以能够减少时延，但是用到的门电路较多，实际成本会很高。因此我们可以选择这种的办法，用4个快速的全加器串联起来组成一个16位的全加器。</li>
</ul>
<h3 id="全加器"><a href="#全加器" class="headerlink" title="全加器"></a>全加器</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">CHIP FastAdd4 &#123;</span><br><span class="line">    IN a[<span class="number">4</span>], b[<span class="number">4</span>], c;</span><br><span class="line">    OUT out[<span class="number">4</span>],</span><br><span class="line">        carry;</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    And (a = a[<span class="number">0</span>], b = b[<span class="number">0</span>], out = g0);</span><br><span class="line">    And (a = a[<span class="number">1</span>], b = b[<span class="number">1</span>], out = g1);</span><br><span class="line">    And (a = a[<span class="number">2</span>], b = b[<span class="number">2</span>], out = g2);</span><br><span class="line">    And (a = a[<span class="number">3</span>], b = b[<span class="number">3</span>], out = g3);</span><br><span class="line"></span><br><span class="line">    Or (a = a[<span class="number">0</span>], b = b[<span class="number">0</span>], out = p0);</span><br><span class="line">    Or (a = a[<span class="number">1</span>], b = b[<span class="number">1</span>], out = p1);</span><br><span class="line">    Or (a = a[<span class="number">2</span>], b = b[<span class="number">2</span>], out = p2);</span><br><span class="line">    Or (a = a[<span class="number">3</span>], b = b[<span class="number">3</span>], out = p3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//c1 = g0 + p0*c0</span></span><br><span class="line">    And (a = p0, b = c, out = p0c0);</span><br><span class="line">    Or (a = g0, b = p0c0, out = c1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//c2 = g1 + p1*g0 + p1*p0*c0</span></span><br><span class="line">    And (a = p1, b = g0, out = p1g0);</span><br><span class="line">    And4Way (in[<span class="number">0</span>] = p1, in[<span class="number">1</span>] = p0, in[<span class="number">2</span>] = c , in[<span class="number">3</span>] = <span class="literal">true</span>, out = p1p0c0);</span><br><span class="line">    Or4Way  (in[<span class="number">0</span>] = g1, in[<span class="number">1</span>] = p1g0,in[<span class="number">2</span>] = p1p0c0, in[<span class="number">3</span>] = <span class="literal">false</span>, out = c2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//c3 = g2 + p2*g1 + p2*p1*g0 + p2*p1*p0*c0</span></span><br><span class="line">    And (a = p2, b = g1, out = p2g1);</span><br><span class="line">    And4Way (in[<span class="number">0</span>] = p2, in[<span class="number">1</span>] = p1, in[<span class="number">2</span>] = g0, in[<span class="number">3</span>] = <span class="literal">true</span>, out = p2p1g0);</span><br><span class="line">    And4Way (in[<span class="number">0</span>] = p2, in[<span class="number">1</span>] = p1, in[<span class="number">2</span>] = p0, in[<span class="number">3</span>] = c, out = p2p1p0c0);</span><br><span class="line">    Or4Way (in[<span class="number">0</span>] = g2, in[<span class="number">1</span>] = p2g1, in[<span class="number">2</span>] = p2p1g0, in[<span class="number">3</span>] = p2p1p0c0, out = c3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//c4 = g3 + p3*g2 + p3*p2*g1 + p3*p2*p1*g0 + p3*p2*p1*p0*c0</span></span><br><span class="line">    And (a = p3, b = g2, out = p3g2);</span><br><span class="line">    And4Way (in[<span class="number">0</span>] = p3, in[<span class="number">1</span>] = p2, in[<span class="number">2</span>] = g1, in[<span class="number">3</span>] = <span class="literal">true</span>, out = p3p2g1);</span><br><span class="line">    And4Way (in[<span class="number">0</span>] = p3, in[<span class="number">1</span>] = p2, in[<span class="number">2</span>] = p1, in[<span class="number">3</span>] = g0, out = p3p2p1g0);</span><br><span class="line">    And8Way (in[<span class="number">0</span>] = p3, in[<span class="number">1</span>] = p2, in[<span class="number">2</span>] = p1, in[<span class="number">3</span>] = p0, in[<span class="number">4</span>] = c, in[<span class="number">5.</span><span class="number">.7</span>] = <span class="literal">true</span>, out = p3p2p1p0c0);</span><br><span class="line">    Or8Way (in[<span class="number">0</span>] = g3, in[<span class="number">1</span>] = p3g2, in[<span class="number">2</span>] = p3p2g1, in[<span class="number">3</span>] = p3p2p1g0, in[<span class="number">4</span>] = p3p2p1p0c0, in[<span class="number">5.</span><span class="number">.7</span>] = <span class="literal">false</span>, out = carry);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a + b</span></span><br><span class="line">    Xor (a = a[<span class="number">0</span>], b = b[<span class="number">0</span>], out = add0);</span><br><span class="line">    Xor (a = add0, b = c , out = out[<span class="number">0</span>]);</span><br><span class="line">    Xor (a = a[<span class="number">1</span>], b = b[<span class="number">1</span>], out = add1);</span><br><span class="line">    Xor (a = add1, b = c1 , out = out[<span class="number">1</span>]);</span><br><span class="line">    Xor (a = a[<span class="number">2</span>], b = b[<span class="number">2</span>], out = add2);</span><br><span class="line">    Xor (a = add2, b = c2 , out = out[<span class="number">2</span>]);</span><br><span class="line">    Xor (a = a[<span class="number">3</span>], b = b[<span class="number">3</span>], out = add3);</span><br><span class="line">    Xor (a = add3, b = c3 , out = out[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CHIP Add16 &#123;</span><br><span class="line">    IN a[<span class="number">16</span>], b[<span class="number">16</span>];</span><br><span class="line">    OUT out[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">   <span class="comment">//Carry-Lookahead Adder , fast adder</span></span><br><span class="line">   FastAdd4 (a = a[<span class="number">0.</span><span class="number">.3</span>], b = b[<span class="number">0.</span><span class="number">.3</span>], c = <span class="literal">false</span>, out = out[<span class="number">0.</span><span class="number">.3</span>], carry = c4);</span><br><span class="line">   FastAdd4 (a = a[<span class="number">4.</span><span class="number">.7</span>], b = b[<span class="number">4.</span><span class="number">.7</span>], c = c4, out = out[<span class="number">4.</span><span class="number">.7</span>], carry = c8);</span><br><span class="line">   FastAdd4 (a = a[<span class="number">8.</span><span class="number">.11</span>], b = b[<span class="number">8.</span><span class="number">.11</span>], c = c8, out = out[<span class="number">8.</span><span class="number">.11</span>], carry = c12);</span><br><span class="line">   FastAdd4 (a = a[<span class="number">12.</span><span class="number">.15</span>], b = b[<span class="number">12.</span><span class="number">.15</span>], c = c12, out = out[<span class="number">12.</span><span class="number">.15</span>], carry = c16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>全加器串联:</p>
<p><img src="https://i.loli.net/2020/09/11/EUjtDbwKPM6BcOy.png" alt="2"><br>全加器直接串联会导致时延</p>
<p><img src="https://i.loli.net/2020/09/11/mrEAYdo6Z7qsxcF.png" alt><br>全加器的推导，并进行优化</p>
<p><img src="https://i.loli.net/2020/09/11/PnVvFBZbwH41Eys.png" alt><br>直接对电路进行优化，可以先求出进位直接代入到加法器中。优化电路时延，减少时延。<br><img src="https://i.loli.net/2020/09/11/IvqXaKgQh3OFnZk.png" alt></p>
<h3 id="ALU"><a href="#ALU" class="headerlink" title="ALU"></a>ALU</h3><ul>
<li><p><code>ALU</code>电路的设计，还是稍微复杂，书写<code>hdl</code>语言稍微复杂点，当时还是思考了很长时间，最后全部通过脚本测试。本质上讲控制信号全部转化为公式，很快即可写出逻辑电路语言。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file is part of www.nand2tetris.org</span></span><br><span class="line"><span class="comment">// and the book "The Elements of Computing Systems"</span></span><br><span class="line"><span class="comment">// by Nisan and Schocken, MIT Press.</span></span><br><span class="line"><span class="comment">// File name: projects/02/ALU.hdl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The ALU (Arithmetic Logic Unit).</span></span><br><span class="line"><span class="comment"> * Computes one of the following functions:</span></span><br><span class="line"><span class="comment"> * x+y, x-y, y-x, 0, 1, -1, x, y, -x, -y, !x, !y,</span></span><br><span class="line"><span class="comment"> * x+1, y+1, x-1, y-1, x&amp;y, x|y on two 16-bit inputs, </span></span><br><span class="line"><span class="comment"> * according to 6 input bits denoted zx,nx,zy,ny,f,no.</span></span><br><span class="line"><span class="comment"> * In addition, the ALU computes two 1-bit outputs:</span></span><br><span class="line"><span class="comment"> * if the ALU output == 0, zr is set to 1; otherwise zr is set to 0;</span></span><br><span class="line"><span class="comment"> * if the ALU output &lt; 0, ng is set to 1; otherwise ng is set to 0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation: the ALU logic manipulates the x and y inputs</span></span><br><span class="line"><span class="comment">// and operates on the resulting values, as follows:</span></span><br><span class="line"><span class="comment">// if (zx == 1) set x = 0        // 16-bit constant</span></span><br><span class="line"><span class="comment">// if (nx == 1) set x = !x       // bitwise not</span></span><br><span class="line"><span class="comment">// if (zy == 1) set y = 0        // 16-bit constant</span></span><br><span class="line"><span class="comment">// if (ny == 1) set y = !y       // bitwise not</span></span><br><span class="line"><span class="comment">// if (f == 1)  set out = x + y  // integer 2's complement addition</span></span><br><span class="line"><span class="comment">// if (f == 0)  set out = x &amp; y  // bitwise and</span></span><br><span class="line"><span class="comment">// if (no == 1) set out = !out   // bitwise not</span></span><br><span class="line"><span class="comment">// if (out == 0) set zr = 1</span></span><br><span class="line"><span class="comment">// if (out &lt; 0) set ng = 1</span></span><br><span class="line"></span><br><span class="line">CHIP ALU &#123;</span><br><span class="line">    IN  </span><br><span class="line">        x[<span class="number">16</span>], y[<span class="number">16</span>],  <span class="comment">// 16-bit inputs        </span></span><br><span class="line">        zx, <span class="comment">// zero the x input?</span></span><br><span class="line">        nx, <span class="comment">// negate the x input?</span></span><br><span class="line">        zy, <span class="comment">// zero the y input?</span></span><br><span class="line">        ny, <span class="comment">// negate the y input?</span></span><br><span class="line">        f,  <span class="comment">// compute out = x + y (if 1) or x &amp; y (if 0)</span></span><br><span class="line">        no; <span class="comment">// negate the out output?</span></span><br><span class="line"></span><br><span class="line">    OUT </span><br><span class="line">        out[<span class="number">16</span>], <span class="comment">// 16-bit output</span></span><br><span class="line">        zr, <span class="comment">// 1 if (out == 0), 0 otherwise</span></span><br><span class="line">        ng; <span class="comment">// 1 if (out &lt; 0),  0 otherwise</span></span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put you code here:</span></span><br><span class="line">    <span class="comment">// clear to zero</span></span><br><span class="line">    <span class="comment">// reverse bit</span></span><br><span class="line">    <span class="comment">// if (zx == 1) set x = 0 </span></span><br><span class="line">    Not (in = zx, out = notzx); </span><br><span class="line">    And1Way16 (a = x, b = notzx, out = zerox);</span><br><span class="line">    <span class="comment">// if (nx == 1) set x = !x</span></span><br><span class="line">    Xor1Way16 (a = zerox, b = nx, out = negx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (zy == 1) set y = 0 </span></span><br><span class="line">    Not (in = zy, out = notzy);</span><br><span class="line">    And1Way16 (a = y, b = notzy, out = zeroy); </span><br><span class="line">    <span class="comment">// if (ny == 1) set y = !y  </span></span><br><span class="line">    Xor1Way16 (a = zeroy, b = ny, out = negy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (f == 1)  set out = x + y</span></span><br><span class="line">    Add16 (a = negx, b = negy, out = sumxy);</span><br><span class="line">    <span class="comment">// if (f == 0)  set out = x &amp; y</span></span><br><span class="line">    And16 (a = negx, b = negy, out = andxy);</span><br><span class="line">    Mux16 (a = andxy, b = sumxy, sel = f ,out = outxy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (no == 1) set out = !out </span></span><br><span class="line">    <span class="comment">// if (out &lt; 0) set ng = 1</span></span><br><span class="line">    Xor1Way16 (a = outxy, b = no, out = out);</span><br><span class="line">    Xor1Way16 (a = outxy, b = no, out[<span class="number">0.</span><span class="number">.14</span>] = negxy, out[<span class="number">15</span>] = ng);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (out == 0) set zr = 1</span></span><br><span class="line">    Or16Way  (in[<span class="number">0.</span><span class="number">.14</span>] = negxy, in[<span class="number">15</span>] = <span class="literal">false</span>,out = zeroout);</span><br><span class="line">    Not (in = zeroout, out = zr);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>扩展ALU</strong>：后期准备为ALU增加功能，即增加基本的乘法器、移位器、浮点运算器这些高级功能，同时对其指令集、汇编语言进行扩展。这时后期的重要工作实现。</p>
</li>
</ul>
<h2 id="week3-Memory"><a href="#week3-Memory" class="headerlink" title="week3 Memory"></a>week3 Memory</h2><p>第三章就稍微复杂点了，当时想了很长时间，还查阅了很多资料。这一章主要描写了最基本的<code>D</code>触发器，寄存器，<code>RAM</code>系统等相关器件和系统。在这里其实重点需要阐述一下<code>D</code>触发器，其实非常有意思，当时还在<code>youtube</code>上找到相关的视频，并进行学习。·youtube</p>
<h3 id="Bit"><a href="#Bit" class="headerlink" title="Bit"></a>Bit</h3><ul>
<li><strong><code>D</code>触发器</strong><br>D触发器是一个具有记忆功能的，具有两个稳定状态的信息存储器件，是构成多种时序电路的最基本逻辑单元，也是数字逻辑电路中一种重要的单元电路。</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/4jIJB1KmXtFs293.png" alt><br>可以参考<code>youtube</code>的视频。关于<code>d</code>触发器(<a href="https://www.youtube.com/watch?v=YW-_GkUguMM),其中将原理图如下：" target="_blank" rel="noopener">https://www.youtube.com/watch?v=YW-_GkUguMM),其中将原理图如下：</a></p>
<p><img src="https://i.loli.net/2020/09/11/7vCXQfioMIUTa5R.png" alt><br>我们可以通过D触发器构造基本的存储单元。</p>
<h3 id="Reigister"><a href="#Reigister" class="headerlink" title="Reigister"></a>Reigister</h3><ul>
<li><strong>寄存器</strong><br>寄存器即为将16位基本的存储单元并联即可，控制信号共享一位控制信号即可。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file is part of www.nand2tetris.org</span></span><br><span class="line"><span class="comment">// and the book "The Elements of Computing Systems"</span></span><br><span class="line"><span class="comment">// by Nisan and Schocken, MIT Press.</span></span><br><span class="line"><span class="comment">// File name: projects/03/a/Register.hdl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 16-bit register:</span></span><br><span class="line"><span class="comment"> * If load[t] == 1 then out[t+1] = in[t]</span></span><br><span class="line"><span class="comment"> * else out does not change</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">CHIP Register &#123;</span><br><span class="line">    IN in[<span class="number">16</span>], load;</span><br><span class="line">    OUT out[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    Bit (in = in[<span class="number">0</span>], load = load, out = out[<span class="number">0</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">1</span>], load = load, out = out[<span class="number">1</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">2</span>], load = load, out = out[<span class="number">2</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">3</span>], load = load, out = out[<span class="number">3</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">4</span>], load = load, out = out[<span class="number">4</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">5</span>], load = load, out = out[<span class="number">5</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">6</span>], load = load, out = out[<span class="number">6</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">7</span>], load = load, out = out[<span class="number">7</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">8</span>], load = load, out = out[<span class="number">8</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">9</span>], load = load, out = out[<span class="number">9</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">10</span>], load = load, out = out[<span class="number">10</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">11</span>], load = load, out = out[<span class="number">11</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">12</span>], load = load, out = out[<span class="number">12</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">13</span>], load = load, out = out[<span class="number">13</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">14</span>], load = load, out = out[<span class="number">14</span>]);</span><br><span class="line">    Bit (in = in[<span class="number">15</span>], load = load, out = out[<span class="number">15</span>]); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h3><ul>
<li><strong>RAM</strong><br>RAM则类似于多个并联的寄存器组合即可，通过地址码翻译为某个寄存器单元的控制信号即可。比较简单<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file is part of www.nand2tetris.org</span></span><br><span class="line"><span class="comment">// and the book "The Elements of Computing Systems"</span></span><br><span class="line"><span class="comment">// by Nisan and Schocken, MIT Press.</span></span><br><span class="line"><span class="comment">// File name: projects/03/a/RAM8.hdl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Memory of 8 registers, each 16 bit-wide. Out holds the value</span></span><br><span class="line"><span class="comment"> * stored at the memory location specified by address. If load==1, then </span></span><br><span class="line"><span class="comment"> * the in value is loaded into the memory location specified by address </span></span><br><span class="line"><span class="comment"> * (the loaded value will be emitted to out from the next time step onward).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">CHIP RAM8 &#123;</span><br><span class="line">    IN in[<span class="number">16</span>], load, address[<span class="number">3</span>];</span><br><span class="line">    OUT out[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    DMux8Way (in = load, sel = address, a = load0, b = load1 , c = load2, d = load3, e = load4, f = load5, g = load6 , h = load7);</span><br><span class="line">    Register (in = in, load = load0 , out = r0);</span><br><span class="line">    Register (in = in, load = load1 , out = r1);</span><br><span class="line">    Register (in = in, load = load2 , out = r2);</span><br><span class="line">    Register (in = in, load = load3 , out = r3);</span><br><span class="line">    Register (in = in, load = load4 , out = r4);</span><br><span class="line">    Register (in = in, load = load5 , out = r5);</span><br><span class="line">    Register (in = in, load = load6 , out = r6);</span><br><span class="line">    Register (in = in, load = load7 , out = r7);</span><br><span class="line">    Mux8Way16 (a = r0, b = r1, c = r2, d = r3, e = r4, f = r5, g = r6, h = r7, sel = address, out = out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="week4-Machine-Language"><a href="#week4-Machine-Language" class="headerlink" title="week4 Machine Language"></a>week4 Machine Language</h2><p>本周则进入了高级编程环节，主要是讲述了自制计算机的指令编码和汇编语言。在<code>hack</code>计算机系统中，指令集只有追基本的<code>A</code> 指令和<code>C</code>指令。</p>
<h3 id="A-instruction"><a href="#A-instruction" class="headerlink" title="A instruction"></a>A instruction</h3><ul>
<li><code>A</code>指令为基本的寻址指令：这个是本科的组成原理中所描述的基本一样，基本的立即寻址、寄存器寻址等等，寻址方式多种。</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/57F2CdWSs8teQxl.png" alt></p>
<h3 id="C-instruction"><a href="#C-instruction" class="headerlink" title="C instruction"></a>C instruction</h3><ul>
<li><code>C</code>指令为基本的运算指令：该指令分为三个部分，计算指令 、存储指令、跳转指令。<br>这一章其实也非常有意思，通过最基本的指令集能够了解到计算机系统的基本面貌。</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/QkbmiatBnFzNIYV.png" alt><br>通过最基本的指令集的组合就可以完成许多高级功能。比如最基本的寻址，加减法，乘法，除法。其实还是非常有意思的，对于整个认识计算机系统有很深入而又全面的了解。<br><img src="https://i.loli.net/2020/09/11/sTAGiozmSlw8Ykv.png" alt></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><p>最基本的乘法：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file is part of www.nand2tetris.org</span></span><br><span class="line"><span class="comment">// and the book "The Elements of Computing Systems"</span></span><br><span class="line"><span class="comment">// by Nisan and Schocken, MIT Press.</span></span><br><span class="line"><span class="comment">// File name: projects/04/Mult.asm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Multiplies R0 and R1 and stores the result in R2.</span></span><br><span class="line"><span class="comment">// (R0, R1, R2 refer to RAM[0], RAM[1], and RAM[2], respectively.)</span></span><br><span class="line"><span class="comment">// created by mike meng @ 2020.7.28</span></span><br><span class="line"><span class="comment">// Put your code here.</span></span><br><span class="line">    @<span class="number">0</span></span><br><span class="line">    D=A</span><br><span class="line">    @R2</span><br><span class="line">    M=D <span class="comment">//set R2 to zero</span></span><br><span class="line"></span><br><span class="line">(LOOP)</span><br><span class="line">    @R1</span><br><span class="line">    D=M</span><br><span class="line">    @END</span><br><span class="line">    D;JEQ <span class="comment">// we first need to test if R1 is zero.</span></span><br><span class="line">    @R0</span><br><span class="line">    D=M</span><br><span class="line">    @R2</span><br><span class="line">    M=M+D <span class="comment">// we add R0 once .</span></span><br><span class="line">    @R1</span><br><span class="line">    M=M<span class="number">-1</span> <span class="comment">// we dec R1 one time.</span></span><br><span class="line">    @LOOP</span><br><span class="line">    <span class="number">0</span>;JMP</span><br><span class="line"></span><br><span class="line">(END)</span><br><span class="line">    @END</span><br><span class="line">    <span class="number">0</span>;JMP</span><br></pre></td></tr></table></figure></p>
<h2 id="week5-Computer-Architecture"><a href="#week5-Computer-Architecture" class="headerlink" title="week5 Computer Architecture"></a>week5 Computer Architecture</h2><p>本章的可以算是本课程上半部分的核心，主要讲之前全部设计的器件组合起来，包括ALU、存储器、PC、ROM。通过这些简单的器件组合即可完成，通过理解计算机系统的基本构成和各个部分的基本原理来理解计算机系统的构成。</p>
<h3 id="Computer"><a href="#Computer" class="headerlink" title="Computer"></a>Computer</h3><ul>
<li>冯诺依曼计算机体系的基本构成，如下图所示。代码和程序放在一个存储器中，通过不同德时钟周期，取指令和取数据来完成计算机系统的运行。另一种讲数据和指令分开存储的称之为哈佛结构，主要是用于<code>DSP</code>上居多。</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/6hswpjAoX8TQEqr.png" alt></p>
<ul>
<li>本次涉及的hack系统基本构成如下：其中<code>ROM</code>存储程序指令，<code>CPU</code>发复杂翻译指令并执行，<code>MEMORY</code>复杂存储和读取数据。<br><img src="https://i.loli.net/2020/09/11/lfxhSpP3nIM7z8o.png" alt><br>相关的逻辑部件链接如下，基本上按照图中的连线进行连接即可完成相关的计算机系统，实际非常简单。<br><img src="https://i.loli.net/2020/09/11/xuN9dYi7sKLPBnH.png" alt></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CHIP Computer &#123;</span><br><span class="line">    IN reset;</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    ROM32K(address = inAddr, out = outRom);</span><br><span class="line">    CPU(inM = outM,instruction = outRom, reset = reset,outM = value,writeM = loadM,addressM = outAddr,pc = inAddr);</span><br><span class="line">    Memory(in = value, load = loadM, address = outAddr, out = outM);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><ul>
<li><strong>CPU</strong><br><code>CPU</code>的结构示意图如下：<br><img src="https://i.loli.net/2020/09/11/nhXMcdkV9eS4W2B.png" alt><br>在<code>hack</code>系统中<code>CPU</code>负责将指令进行翻译，<code>hack</code>系统存在<code>A</code>指令与<code>C</code>指令。翻译指令还是比较复杂，如果发现为<code>A</code>指令，则直接将<code>A</code>寄存器设置为指令中的地址数据，如果发现为<code>C</code>指令则分别存储、运算、跳转三个子部分进行解释:</li>
</ul>
<ol>
<li><code>c</code>指令的基本结构：<br><img src="https://i.loli.net/2020/09/11/QkbmiatBnFzNIYV.png" alt></li>
<li>计算指令部分解析：<br><img src="https://i.loli.net/2020/09/11/fFDZK8HrBYs9uhQ.png" alt></li>
<li>存储指令部分解析：<br><img src="https://i.loli.net/2020/09/11/HRDN1X2iuO6BWlr.png" alt></li>
<li>跳转指令部分解析：<br><img src="https://i.loli.net/2020/09/11/ZNPM2d9aIQYODCl.png" alt><br>CPU的HDL代码稍微复杂点，大概花了半天时间最终搞定，有几个小问题思考花费了不少时间。特别是关于存储指令的部分，需要将<code>ALU</code>的运算结果存储到不同的存储器中需要花费不少的细节问题,可以将其存储到<code>A</code>寄存器，<code>D</code>寄存器，<code>MEMORY</code>中。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CHIP CPU &#123;</span><br><span class="line">    IN  inM[<span class="number">16</span>],         <span class="comment">// M value input  (M = contents of RAM[A])</span></span><br><span class="line">        instruction[<span class="number">16</span>], <span class="comment">// Instruction for execution</span></span><br><span class="line">        reset;           <span class="comment">// Signals whether to re-start the current</span></span><br><span class="line">                         <span class="comment">// program (reset==1) or continue executing</span></span><br><span class="line">                         <span class="comment">// the current program (reset==0).</span></span><br><span class="line"></span><br><span class="line">    OUT outM[<span class="number">16</span>],        <span class="comment">// M value output</span></span><br><span class="line">        writeM,          <span class="comment">// Write to M? </span></span><br><span class="line">        addressM[<span class="number">15</span>],    <span class="comment">// Address in data memory (of M)</span></span><br><span class="line">        pc[<span class="number">15</span>];          <span class="comment">// address of next instruction</span></span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    <span class="comment">//A Instruction</span></span><br><span class="line">    Not(in = instruction[<span class="number">15</span>], out = loadA);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//C Instruction</span></span><br><span class="line">    Mux16(a = Addr, b = inM, sel = instruction[<span class="number">12</span>], out = outAM);</span><br><span class="line">    ALU(x = outD, y = outAM, zx = instruction[<span class="number">11</span>], nx = instruction[<span class="number">10</span>],zy = instruction[<span class="number">9</span>],ny = instruction[<span class="number">8</span>],f = instruction[<span class="number">7</span>], no = instruction[<span class="number">6</span>], out = outC, out = outM,zr = outZr, ng = outNg);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//store compute result</span></span><br><span class="line">    DMux8Way(in = <span class="literal">true</span>, sel = instruction[<span class="number">3.</span><span class="number">.5</span>], a = selnull, b = selM, c = selD, d = selMD, e = selA, f = selAM, g = selAD, h = selAMD);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//store M </span></span><br><span class="line">    Or8Way(in[<span class="number">0</span>] = selM, in[<span class="number">1</span>] = selMD, in[<span class="number">2</span>] = selMD, in[<span class="number">3</span>] = selAMD,in[<span class="number">4.</span><span class="number">.7</span>] = <span class="literal">false</span>, out = storeM);</span><br><span class="line">    And(a = storeM, b = instruction[<span class="number">15</span>], out = writeM);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//store D</span></span><br><span class="line">    Or8Way(in[<span class="number">0</span>] = selD, in[<span class="number">1</span>] = selMD, in[<span class="number">2</span>] = selAD, in[<span class="number">3</span>] = selAMD,in[<span class="number">4.</span><span class="number">.7</span>] = <span class="literal">false</span>, out = storeD);</span><br><span class="line">    And(a = storeD, b = instruction[<span class="number">15</span>], out = writeD);</span><br><span class="line">    DRegister(in = outC ,load = writeD, out = outD);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//store A</span></span><br><span class="line">    Or8Way(in[<span class="number">0</span>] = selA, in[<span class="number">1</span>] = selAM, in[<span class="number">2</span>] = selAD, in[<span class="number">3</span>] = selAMD,in[<span class="number">4.</span><span class="number">.7</span>] = <span class="literal">false</span>, out = storeA);</span><br><span class="line">    Mux16(a[<span class="number">15</span>] = <span class="literal">false</span>,a[<span class="number">0.</span><span class="number">.14</span>] = instruction[<span class="number">0.</span><span class="number">.14</span>], b = outC, sel = instruction[<span class="number">15</span>], out = outAddr);</span><br><span class="line">    Or(a = loadA, b = storeA, out = writeA);</span><br><span class="line">    ARegister(in = outAddr, load = writeA, out = Addr,out[<span class="number">0.</span><span class="number">.14</span>] = addressM);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Jump PC</span></span><br><span class="line">    DMux8Way(in = instruction[<span class="number">15</span>],sel = instruction[<span class="number">0.</span><span class="number">.2</span>], a = JNULL, b = JGT, c = JEQ, d = JGE, e = JLT, f = JNE, g = JLE, h = JMP);</span><br><span class="line">    Not(in = outZr, out = notZero);</span><br><span class="line">    Not(in = outNg, out = notNeg);</span><br><span class="line">    And(a = JEQ, b = outZr, out = loadEQ);</span><br><span class="line">    And(a = JNE, b = notZero, out = loadNE);</span><br><span class="line">    And(a = JLT, b = outNg, out = loadLT);</span><br><span class="line">    And(a = JGE, b = notNeg, out = loadGE);</span><br><span class="line">    And(a = notZero, b = notNeg, out = outGT);</span><br><span class="line">    And(a = outGT, b = JGT, out = loadGT);</span><br><span class="line">    Or(a = outZr, b = outNg, out = outLE);</span><br><span class="line">    And(a = outLE, b = JLE, out = loadLE);</span><br><span class="line">    Or8Way(in[<span class="number">0</span>] = loadGT, in[<span class="number">1</span>] = loadEQ, in[<span class="number">2</span>] = loadGE, in[<span class="number">3</span>] = loadLT, in[<span class="number">4</span>] = loadNE, in[<span class="number">5</span>] = loadLE, in[<span class="number">6</span>] = JMP, in[<span class="number">7</span>] = <span class="literal">false</span>, out = loadPC);</span><br><span class="line">    PC(in = Addr,load = loadPC,inc = <span class="literal">true</span>,reset = reset, out[<span class="number">0.</span><span class="number">.14</span>] = pc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><ul>
<li><strong>MEMORY</strong><br><strong>memory</strong>部分较为简单，主要是注意到地址信号线的选择计算问题即可。其余的难度不大，基本上是组成原理中学的那套东西。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CHIP Memory &#123;</span><br><span class="line">    IN in[<span class="number">16</span>], load, address[<span class="number">15</span>];</span><br><span class="line">    OUT out[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">    PARTS:</span><br><span class="line">    <span class="comment">// Put your code here:</span></span><br><span class="line">    <span class="comment">//load mux</span></span><br><span class="line">    DMux(in = load, sel = address[<span class="number">14</span>] , a = loadram , b = loadmm);</span><br><span class="line">    DMux(in = loadmm, sel = address[<span class="number">13</span>], a = loadscreen, b = loadkeyboard);</span><br><span class="line">    RAM16K(in = in,load = loadram,address = address[<span class="number">0.</span><span class="number">.13</span>] , out = outram);</span><br><span class="line">    Screen(in = in,load = loadscreen,address = address[<span class="number">0.</span><span class="number">.12</span>] , out = outscreen);</span><br><span class="line">    Keyboard(out = outkeyboard);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//out mux</span></span><br><span class="line">    Mux16(a = outscreen, b = outkeyboard, sel = address[<span class="number">13</span>], out = outmm);</span><br><span class="line">    Mux16(a = outram, b = outmm, sel = address[<span class="number">14</span>], out = out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="week6-Assembler"><a href="#week6-Assembler" class="headerlink" title="week6 Assembler"></a>week6 Assembler</h2><p>本章的内容其实较为简单，主要是为<code>hack</code>系统编写一个汇编解释器，将汇编语言编译为机器码，其实主要是掌握<code>hack</code>系统的基本指令即可。实际的<code>hack</code>系统中有几种指令和符号系统：</p>
<ul>
<li><strong>A</strong>指令： 这个基本的汇编语言主要是以<code>@</code>开头的汇编程序指令解析即可。</li>
<li><strong>C</strong>指令:  这部分也很容易主要查看是否有<code>;</code>与<code>=</code>即可判断该指令，并且将其分为三个部分，<code>计算</code>、<code>存储</code>、<code>跳转</code>。</li>
<li><strong>固定符号</strong>: 实际指令执行过程中我们只需要将这些固定标签翻译为特定地址即可。</li>
</ul>
<p><img src="https://i.loli.net/2020/09/11/2zXTNlhvWBJEytj.png" alt></p>
<ul>
<li><strong>变量符号</strong>: 我们在实际过程运算过程中遇到第一个<code>A</code>指令时，则认为该符号变量的地址。后续的变量地址则固定进行递增即可，按照固定的地址是从<code>16</code>开始。我们检测<code>A</code>指令时遇到的第一个标签。</li>
<li><strong>跳转标签</strong>: 我们在程序的运行过程中有许多程序的跳转指令，比如跳转到某个固定的指令地址起开始执行，实际即为将<code>PC</code>寄存器的内容修改为跳转地址即可。我们解析时主要解析查看汇编语言中是否存在<code>()</code>即可。</li>
</ul>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEGBUG_LEVEL 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INFO_LEVEL 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WARNINT_LEVEL 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR_LEVEL 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_ADDR 190000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> START_ADDR_OPEN 16</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEMORY_ADDR_LEN 15</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> debug = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trace</span><span class="params">(<span class="keyword">int</span> level,<span class="built_in">string</span> text)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;text&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trimSpace</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!s.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> pos1 = s.find_first_not_of(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">if</span>(pos1 != <span class="built_in">string</span>::npos) s.erase(<span class="number">0</span>,pos1);</span><br><span class="line">        <span class="keyword">int</span> pos2 = s.find_last_not_of(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">if</span>(pos2 != <span class="built_in">string</span>::npos) s.erase(pos2+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trimComments</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!s.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> pos = s.find_first_of(<span class="string">"//"</span>);</span><br><span class="line">        <span class="keyword">if</span>(pos != <span class="built_in">string</span>::npos) s.erase(pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isDigit</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isUpper</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNumber</span><span class="params">(<span class="built_in">string</span> &amp; s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(s[<span class="number">0</span>] == <span class="string">'0'</span> &amp;&amp; s.size() != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.size(); ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!isDigit(s[i])) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        sum = sum*<span class="number">10</span> + s[i] - <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; MAX_ADDR) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">checkMnemonics</span><span class="params">(<span class="built_in">string</span> &amp; s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> c : s)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!isUpper(c)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">binaryCode</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)&#123;</span><br><span class="line">        ans = to_string(x%<span class="number">2</span>) + ans;</span><br><span class="line">        x = x&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initPredefTable</span><span class="params">(<span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; &amp; symbolTable)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*Predefined Symbols*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i)&#123;</span><br><span class="line">        symbolTable[<span class="string">"R"</span> + to_string(i)] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    symbolTable[<span class="string">"SP"</span>] = <span class="number">0</span>;</span><br><span class="line">    symbolTable[<span class="string">"LCL"</span>] = <span class="number">1</span>;</span><br><span class="line">    symbolTable[<span class="string">"ARG"</span>] = <span class="number">2</span>;</span><br><span class="line">    symbolTable[<span class="string">"THIS"</span>] = <span class="number">3</span>;</span><br><span class="line">    symbolTable[<span class="string">"THAT"</span>] = <span class="number">4</span>;</span><br><span class="line">    symbolTable[<span class="string">"SCREEN"</span>] = <span class="number">16384</span>;</span><br><span class="line">    symbolTable[<span class="string">"KBD"</span>] = <span class="number">24576</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initJumpTable</span><span class="params">(<span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; &amp; jumpTable)</span></span>&#123;</span><br><span class="line">    jumpTable[<span class="string">""</span>] = <span class="string">"000"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JGT"</span>] = <span class="string">"001"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JEQ"</span>] = <span class="string">"010"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JGE"</span>] = <span class="string">"011"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JLT"</span>] = <span class="string">"100"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JNE"</span>] = <span class="string">"101"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JLE"</span>] = <span class="string">"110"</span>;</span><br><span class="line">    jumpTable[<span class="string">"JMP"</span>] = <span class="string">"111"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initDestTable</span><span class="params">(<span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; &amp; destTable)</span></span>&#123;</span><br><span class="line">    destTable[<span class="string">""</span>] = <span class="string">"000"</span>;</span><br><span class="line">    destTable[<span class="string">"M"</span>] = <span class="string">"001"</span>;</span><br><span class="line">    destTable[<span class="string">"D"</span>] = <span class="string">"010"</span>;</span><br><span class="line">    destTable[<span class="string">"MD"</span>] = <span class="string">"011"</span>;</span><br><span class="line">    destTable[<span class="string">"A"</span>] = <span class="string">"100"</span>;</span><br><span class="line">    destTable[<span class="string">"AM"</span>] = <span class="string">"101"</span>;</span><br><span class="line">    destTable[<span class="string">"AD"</span>] = <span class="string">"110"</span>;</span><br><span class="line">    destTable[<span class="string">"AMD"</span>] = <span class="string">"111"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initCompTable</span><span class="params">(<span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; &amp; compTable)</span></span>&#123;</span><br><span class="line">    compTable[<span class="string">"0"</span>]   = <span class="string">"0101010"</span>;</span><br><span class="line">    compTable[<span class="string">"1"</span>]   = <span class="string">"0111111"</span>;</span><br><span class="line">    compTable[<span class="string">"-1"</span>]  = <span class="string">"0111010"</span>;</span><br><span class="line">    compTable[<span class="string">"D"</span>]   = <span class="string">"0001100"</span>;</span><br><span class="line">    compTable[<span class="string">"A"</span>]   = <span class="string">"0110000"</span>;</span><br><span class="line">    compTable[<span class="string">"M"</span>]   = <span class="string">"1110000"</span>;</span><br><span class="line">    compTable[<span class="string">"!D"</span>]  = <span class="string">"0001101"</span>;</span><br><span class="line">    compTable[<span class="string">"!A"</span>]  = <span class="string">"0110001"</span>;</span><br><span class="line">    compTable[<span class="string">"!M"</span>]  = <span class="string">"1110001"</span>;</span><br><span class="line">    compTable[<span class="string">"-D"</span>]  = <span class="string">"0001111"</span>;</span><br><span class="line">    compTable[<span class="string">"-A"</span>]  = <span class="string">"0110011"</span>;</span><br><span class="line">    compTable[<span class="string">"-M"</span>]  = <span class="string">"1110011"</span>;</span><br><span class="line">    compTable[<span class="string">"D+1"</span>] = <span class="string">"0011111"</span>;</span><br><span class="line">    compTable[<span class="string">"A+1"</span>] = <span class="string">"0110111"</span>;</span><br><span class="line">    compTable[<span class="string">"M+1"</span>] = <span class="string">"1110111"</span>;</span><br><span class="line">    compTable[<span class="string">"D-1"</span>] = <span class="string">"0001110"</span>;</span><br><span class="line">    compTable[<span class="string">"A-1"</span>] = <span class="string">"0110010"</span>;</span><br><span class="line">    compTable[<span class="string">"M-1"</span>] = <span class="string">"1110010"</span>;</span><br><span class="line">    compTable[<span class="string">"D+A"</span>] = <span class="string">"0000010"</span>;</span><br><span class="line">    compTable[<span class="string">"D+M"</span>] = <span class="string">"1000010"</span>;</span><br><span class="line">    compTable[<span class="string">"D-A"</span>] = <span class="string">"0010011"</span>;</span><br><span class="line">    compTable[<span class="string">"D-M"</span>] = <span class="string">"1010011"</span>;</span><br><span class="line">    compTable[<span class="string">"A-D"</span>] = <span class="string">"0000111"</span>;</span><br><span class="line">    compTable[<span class="string">"M-D"</span>] = <span class="string">"1000111"</span>;</span><br><span class="line">    compTable[<span class="string">"D&amp;A"</span>] = <span class="string">"0000000"</span>;</span><br><span class="line">    compTable[<span class="string">"D&amp;M"</span>] = <span class="string">"1000000"</span>;</span><br><span class="line">    compTable[<span class="string">"D|A"</span>] = <span class="string">"0010101"</span>;</span><br><span class="line">    compTable[<span class="string">"D|M"</span>] = <span class="string">"1010101"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span></span>&#123;</span><br><span class="line">    ifstream fin;</span><br><span class="line">    ofstream fout;</span><br><span class="line">    <span class="keyword">int</span> currAddr = START_ADDR_OPEN;</span><br><span class="line">    <span class="keyword">int</span> currLine = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;  symbolTable;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;   labelTable;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; jumpTable;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; destTable;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; compTable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*initial symbol table*/</span></span><br><span class="line">    initPredefTable(symbolTable);</span><br><span class="line">    initJumpTable(jumpTable);</span><br><span class="line">    initDestTable(destTable);</span><br><span class="line">    initCompTable(compTable);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>) &#123;</span><br><span class="line">        trace(ERROR_LEVEL,<span class="string">"Wrong File, Bad parameter.\n\r"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fin.open(argv[<span class="number">1</span>],<span class="built_in">std</span>::ifstream::in);</span><br><span class="line">    fout.open(argv[<span class="number">2</span>],<span class="built_in">std</span>::ifstream::out);</span><br><span class="line">    <span class="keyword">if</span>(!fin||!fout)&#123;</span><br><span class="line">        trace(ERROR_LEVEL,<span class="string">"Wrong File, Bad parameter.\n\r"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*read assembler program from file*/</span></span><br><span class="line">    <span class="comment">/*parse label*/</span></span><br><span class="line">    <span class="built_in">string</span> assembler;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; assemblerArr;</span><br><span class="line">    <span class="keyword">while</span>(getline(fin,assembler))&#123;</span><br><span class="line">        trimComments(assembler); <span class="comment">// trim comments</span></span><br><span class="line">        trimSpace(assembler); <span class="comment">//trim space</span></span><br><span class="line">        <span class="keyword">if</span>(assembler.empty() || assembler.size() &lt; <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(assembler[<span class="number">0</span>] == <span class="string">'('</span>)&#123;</span><br><span class="line">            <span class="comment">/*parse Label*/</span></span><br><span class="line">            <span class="keyword">if</span>(assembler.back() != <span class="string">')'</span>)&#123;</span><br><span class="line">                trace(ERROR_LEVEL,<span class="string">"Wrong Assembler, we need right ')'.\n\r"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(assembler.size() &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">                trace(ERROR_LEVEL,<span class="string">"Wrong Assembler, label can not be empty!\n\r"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">string</span> label = assembler.substr(<span class="number">1</span>,assembler.size()<span class="number">-2</span>);</span><br><span class="line">            labelTable[label] = currLine;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            assemblerArr.push_back(assembler);</span><br><span class="line">            currLine++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> v : assemblerArr)&#123;</span><br><span class="line">        <span class="comment">/*parse A instruction*/</span></span><br><span class="line">        <span class="built_in">string</span> instruction;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(v[<span class="number">0</span>] == <span class="string">'@'</span>)&#123;</span><br><span class="line">            instruction = <span class="string">"0"</span>;</span><br><span class="line">            <span class="built_in">string</span> var = v.substr(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> address = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(isNumber(var))&#123;</span><br><span class="line">                address = stoi(var);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(symbolTable.count(var))&#123;</span><br><span class="line">                    address = symbolTable[var];</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(labelTable.count(var))&#123;</span><br><span class="line">                    address = labelTable[var];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    address = currAddr++;</span><br><span class="line">                    symbolTable[var] = address;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            instruction += binaryCode(address,MEMORY_ADDR_LEN);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">/*parse C instruction*/</span></span><br><span class="line">            instruction = <span class="string">"111"</span>;</span><br><span class="line">            <span class="built_in">string</span> dest = <span class="string">""</span>;</span><br><span class="line">            <span class="built_in">string</span> comp = <span class="string">""</span>;</span><br><span class="line">            <span class="built_in">string</span> jump = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> pos1 = v.find_first_of(<span class="string">";"</span>);</span><br><span class="line">            <span class="keyword">int</span> pos2 = v.find_first_of(<span class="string">"="</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(pos1 == <span class="built_in">string</span>::npos &amp;&amp; pos2 == <span class="built_in">string</span>::npos)&#123;</span><br><span class="line">                trace(ERROR_LEVEL,<span class="string">"Wrong Assembler, we need the right command!\n\r"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(pos1 == <span class="built_in">string</span>::npos)&#123;</span><br><span class="line">                jump = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">if</span>(pos2 != <span class="built_in">string</span>::npos)&#123;</span><br><span class="line">                    dest = v.substr(<span class="number">0</span>,pos2);</span><br><span class="line">                    comp = v.substr(pos2+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                jump = v.substr(pos1+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(pos2 != <span class="built_in">string</span>::npos)&#123;</span><br><span class="line">                    dest = v.substr(<span class="number">0</span>,pos2);</span><br><span class="line">                    comp = v.substr(pos2+<span class="number">1</span>,pos1-pos2<span class="number">-1</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    comp = v.substr(<span class="number">0</span>,pos1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!jumpTable.count(jump)||</span><br><span class="line">               !compTable.count(comp)||</span><br><span class="line">               !destTable.count(dest))&#123;</span><br><span class="line">                   trace(ERROR_LEVEL,<span class="string">"Wrong Assembler, we need the right command!\n\r"</span>);</span><br><span class="line">                   <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            instruction += compTable[comp] + destTable[dest] + jumpTable[jump];</span><br><span class="line">        &#125;</span><br><span class="line">        fout&lt;&lt;instruction&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    fin.close();</span><br><span class="line">    fout.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p><code>build a computer</code>该课程上半部分已经全部学完了，总的来说课程还是非常有意思，比本科时上的计算机组成原理有意思多了。还是有很多让人回味的地方，下半部分的课程主要是讲<code>虚拟机</code>,<code>编程语言</code>,<code>编译器</code>,<code>操作系统</code>等纯软件的部分。总的课程还是非常适合计算机专业或者非计算机专业认真学习的，计划在后续的两个月内完成下半部分的课程，主要是写代码较多，<code>project</code>的难度较大。</p>
<ul>
<li>后期准备将所有的<code>project</code>用<code>logsim</code>全部重新写一遍。</li>
<li>扩展ALU的功能，能够实现移位器、乘法器、浮点运算器的实现。</li>
<li>扩展<code>hack</code>汇编程序，实现基本的支持浮点运算器、移位操作、乘法操作的语言。</li>
</ul>

    </div>

    
    
    
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/images/2876768308.jpg" alt="Mike meng wechat" style="width: 200px; max-width: 100%;">
  <div>公务程序猿.</div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/coursera/" rel="tag"># coursera</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>


          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/08/31/198/" rel="next" title="【AtCoder】 Contest177">
                  <i class="fa fa-chevron-left"></i> 【AtCoder】 Contest177
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/09/06/200/" rel="prev" title="【Leetcode】 33周双周赛">
                  【Leetcode】 33周双周赛 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Build-a-Modern-Computer-from-First-Principles-Nand-to-Tetris-Part-I-project-centered-course"><span class="nav-number">1.</span> <span class="nav-text">Build a Modern Computer from First Principles: Nand to Tetris Part I (project-centered course)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#week1-Boolean-Logic"><span class="nav-number">1.1.</span> <span class="nav-text">week1 Boolean Logic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码"><span class="nav-number">1.1.1.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#week2-Boolean-Arithmetic"><span class="nav-number">1.2.</span> <span class="nav-text">week2 Boolean Arithmetic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#全加器"><span class="nav-number">1.2.1.</span> <span class="nav-text">全加器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALU"><span class="nav-number">1.2.2.</span> <span class="nav-text">ALU</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#week3-Memory"><span class="nav-number">1.3.</span> <span class="nav-text">week3 Memory</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Bit"><span class="nav-number">1.3.1.</span> <span class="nav-text">Bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reigister"><span class="nav-number">1.3.2.</span> <span class="nav-text">Reigister</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RAM"><span class="nav-number">1.3.3.</span> <span class="nav-text">RAM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#week4-Machine-Language"><span class="nav-number">1.4.</span> <span class="nav-text">week4 Machine Language</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-instruction"><span class="nav-number">1.4.1.</span> <span class="nav-text">A instruction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-instruction"><span class="nav-number">1.4.2.</span> <span class="nav-text">C instruction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码-1"><span class="nav-number">1.4.3.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#week5-Computer-Architecture"><span class="nav-number">1.5.</span> <span class="nav-text">week5 Computer Architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Computer"><span class="nav-number">1.5.1.</span> <span class="nav-text">Computer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU"><span class="nav-number">1.5.2.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory"><span class="nav-number">1.5.3.</span> <span class="nav-text">Memory</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#week6-Assembler"><span class="nav-number">1.6.</span> <span class="nav-text">week6 Assembler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码-2"><span class="nav-number">1.6.1.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">2.</span> <span class="nav-text">Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Mike meng"
    src="/images/pic.jpg">
  <p class="site-author-name" itemprop="name">Mike meng</p>
  <div class="site-description" itemprop="description">a clever man and a foolish man!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">243</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/mike-box" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;mike-box" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mml1106@126.com" title="E-Mail &amp;rarr; mailto:mml1106@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/mike-box/mike-box.github.io/blob/master/atom.xml" title="Feed &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;mike-box&#x2F;mike-box.github.io&#x2F;blob&#x2F;master&#x2F;atom.xml" rel="noopener" target="_blank"><i class="fa fa-fw fa-Feed"></i>Feed</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" >| 总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span>
<span id="busuanzi_container_site_uv" >| 总访客数 <span id="busuanzi_value_site_uv"></span> 人 </span>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.2"></script><script src="/js/motion.js?v=7.4.2"></script>
<script src="/js/schemes/pisces.js?v=7.4.2"></script>
<script src="/js/next-boot.js?v=7.4.2"></script>



  





  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id: ,
      el: 'wpac-rating',
      color: 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>













  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '8Dt7hB7Fx8exlW88EXinb5mF-gzGzoHsz',
    appKey: 'aWHmgsVOAHuLla4w3OV0UOqh',
    placeholder: "Just go go",
    avatar: 'wavatar',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
